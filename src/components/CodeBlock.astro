---
import { Code } from "astro/components";

type Props = {
  tabs: Array<{ filename: string; language: string; code: string; class?: string }>;
};

const { tabs } = Astro.props;
---

<div class="code-tabs-container">
  <div class="scrollbar-hidden flex max-w-full flex-row overflow-x-scroll">
    {
      tabs.map((tab) => (
        <div data-filename={tab.filename} class="code-tabs-container__tab">
          {tab.filename}
        </div>
      ))
    }
  </div>
  <div>
    {
      tabs.map((tab) => (
        <div class:list={["code-tabs-container__code-container", tab.class]} data-filename={tab.filename}>
          <Code lang={tab.language} code={tab.code.trim()} />
        </div>
      ))
    }
  </div>
</div>

<style is:global>
  .code-tabs-container {
    @apply my-8;
    @apply flex flex-col;

    &__code-container {
      &--hidden {
        @apply hidden;
      }

      pre.astro-code {
        @apply !my-0 !rounded-t-none;
      }
    }

    &__tab {
      @apply rounded-t-lg bg-slate-500 px-4 py-2 font-mono text-xs text-slate-300;
      @apply hover:cursor-pointer;

      &--selected {
        @apply bg-slate-800 text-slate-100 shadow;
      }
    }
  }
</style>

<script>
  document.querySelectorAll(".code-tabs-container").forEach((container) => {
    const tabs = container.querySelectorAll(".code-tabs-container__tab");

    function selectTab(name: string): void {
      tabs.forEach((tab) => {
        if (tab.dataset.filename !== name) {
          tab.classList.remove("code-tabs-container__tab--selected");
        } else {
          tab.classList.add("code-tabs-container__tab--selected");
        }
      });

      container.querySelectorAll(".code-tabs-container__code-container").forEach((codeContainer) => {
        if (codeContainer.dataset.filename !== name) {
          codeContainer.classList.add("code-tabs-container__code-container--hidden");
        } else {
          codeContainer.classList.remove("code-tabs-container__code-container--hidden");
        }
      });
    }

    tabs.forEach((element) => {
      element.addEventListener("click", () => {
        const filename = element.dataset.filename;
        selectTab(filename);
      });
    });

    selectTab(tabs[0].dataset.filename);
  });
</script>
